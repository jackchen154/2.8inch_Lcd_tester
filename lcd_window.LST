C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD_WINDOW
OBJECT MODULE PLACED IN lcd_window.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE lcd_window.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "STC12C5A.h"
   2          #include "uart.h"
   3          #include "lcd_window.h"
   4          #include "main.h"
   5          #define uchar unsigned char
   6          #define FALSE  -1
   7          #define TRUE   0
   8          
   9          
  10          int Lcd_control(char *cmd)//æ¨¡å¼è®¾ç½®
  11          {
  12   1        //uchar receive_buf[4];//LCDè¿”å›æ•°æ®buf
  13   1        uchar *cmdbuf=(uchar *)cmd;
  14   1        uchar end_frame[]={0xff,0xff,0xff};//LCDå‘é€å¸§å°¾éƒ¨
  15   1        uchar len=0;
  16   1      
  17   1        while(*cmdbuf!='\0')//è®¡ç®—å­—ç¬¦ä¸ªæ•°
  18   1        {
  19   2          cmdbuf++;
  20   2          len++;
  21   2        }
  22   1         
  23   1        UART2_Send((uchar *)cmd,len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
  24   1        delayms(10);
  25   1        UART2_Send(end_frame,3);//å‘é€LCDå¸§å°¾
  26   1      
  27   1        return TRUE;   
  28   1      
  29   1      }
  30          
  31          /******************************************************************
  32          åŠŸèƒ½ï¼šå°†ä¸€ä¸ª32ä½é•¿æ•´å‹å˜é‡datè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æŠŠ1234è½¬ä¸º"1234"
  33          å‚æ•°ï¼šdat:å¾…è½¬çš„longå‹çš„å˜é‡
  34               str:æŒ‡å‘å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆï¼Œè½¬æ¢åçš„å­—èŠ‚ä¸²æ”¾åœ¨å…¶ä¸­   
  35          è¿”å›ï¼šè½¬æ¢åçš„å­—ç¬¦ä¸²é•¿åº¦                                
  36          ******************************************************************/
  37          unsigned char int2str(int dat,unsigned char *str) // é•¿æ•´å‹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿”å›å€¼ä¸ºè½¬æ¢å
             -çš„å­—ç¬¦ä¸²é•¿åº¦
  38          {
  39   1        signed char i=0;
  40   1        unsigned char len = 0;
  41   1        unsigned char buf[6]={0}; // é•¿æ•´æ•°æœ€å¤§å€¼4294967295ï¼Œè½¬ASCIIç åå ç”¨10+1=11å­—èŠ‚
  42   1        if (dat < 0)// å¦‚æœä¸ºè´Ÿæ•°ï¼Œé¦–å…ˆå–ç»å¯¹å€¼ï¼Œå¹¶æ·»åŠ è´Ÿå·
  43   1        {
  44   2          dat = -dat;
  45   2          *str++ = '-';
  46   2          len++;
  47   2        }
  48   1        do
  49   1        {// ä½ä½åœ¨å‰é«˜ä½åœ¨åé¡ºåºæ’åˆ—
  50   2          buf[i++] = dat % 10+0x30;// Cè¯­è¨€ä¸­æ•°ç»„ä¸‹æ ‡å›ºå®šä»0å¼€å§‹
  51   2          dat /= 10;
  52   2        } while (dat > 0);
  53   1        len += i;                 // iæœ€åçš„å€¼å°±æ˜¯æœ‰æ•ˆå­—ç¬¦çš„ä¸ªæ•°
  54   1        while (i-- > 0)           // é«˜ä½åœ¨å‰ä½ä½åœ¨åé¡ºåºæ’åˆ—
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 2   

  55   1        {
  56   2          *str++ = buf[i] ;
  57   2        }     
  58   1        *str = 0;                 // æ·»åŠ å­—ç¬¦ä¸²ç»“æŸç¬¦æ–¹ä¾¿ä½¿ç”¨KEILè‡ªå¸¦çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å¤„ç
             -†
  59   1        return len;               // è¿”å›å­—ç¬¦ä¸²é•¿åº¦
  60   1      }
  61          
  62          
  63          int Lcd_set_val(char *cmd, int val)//æ¨¡å¼è®¾ç½®
  64          {
  65   1        //uchar receive_buf[4];
  66   1        uchar val_buf[5]={0};//intè½¬charçš„ç¼“å­˜ 
  67   1        uchar val_len=0;//è½¬æ¢åçš„æ•°å­—æœ‰å¤šå°‘ä½æ•°
  68   1        uchar *cmd_buf = (uchar *)cmd;
  69   1        uchar end_frame[]={0xff,0xff,0xff};//å¸§å°¾
  70   1        uchar cmd_len=0;
  71   1        val_len = int2str(val,val_buf);//æ•´å‹è½¬å­—ç¬¦å‹
  72   1      
  73   1        while(*cmd_buf!='\0')
  74   1        {
  75   2          cmd_buf++;
  76   2          cmd_len++;
  77   2        }
  78   1      
  79   1        UART2_Send((uchar *)cmd,cmd_len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
  80   1      
  81   1        UART2_Send(val_buf,val_len);//å‘é€æ•°å­— 
  82   1      
  83   1        UART2_Send(end_frame,3);//å¸§å°¾éƒ¨
  84   1       
  85   1          return TRUE;    
  86   1      
  87   1      }
  88          
  89          
  90          //tou_led.txt="V12.00.02"
  91          //è¯¥ä¸ºè‡ªå¸¦æ¸…bufçš„æ­¥éª¤
  92          int Lcd_set_txt(char *cmd,unsigned short *real_data)//æ¨¡å¼è®¾ç½®
  93          {
  94   1      
  95   1        uchar *cmd_buf = (uchar *)cmd;
  96   1        uchar clear_data=50;
  97   1        uchar end_frame[]={0xff,0xff,0xff};//å¸§å°¾
  98   1        uchar disbuf[11]={0};
  99   1        uchar cmd_len=0;
 100   1      
 101   1        disbuf[0]='"';
 102   1        disbuf[1]='V';
 103   1        if((*(real_data)>>8)>9)//å¦‚æœä¸»ç‰ˆæœ¬å·å¤§äº9
 104   1        {
 105   2          disbuf[2]=(*(real_data)>>8)/10+48;
 106   2          disbuf[3]=(*(real_data)>>8)%10+48;
 107   2        }
 108   1        else
 109   1        {
 110   2          disbuf[2]= '0';
 111   2          disbuf[3]=(*(real_data)>>8)+48;
 112   2        }
 113   1        disbuf[4]='.';
 114   1        
 115   1        if((*(real_data)&0x00ff)>9)//å¦‚æœä¸»ç‰ˆæœ¬å·å¤§äº9
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 3   

 116   1        {
 117   2          disbuf[5]=(*(real_data)&0x00ff)/10+48;
 118   2          disbuf[6]=(*(real_data)&0x00ff)%10+48;
 119   2        }
 120   1        else
 121   1        {
 122   2          disbuf[5]= '0';
 123   2          disbuf[6]=(*(real_data)&0x00ff)+48;
 124   2        }
 125   1      
 126   1        disbuf[7]='.';
 127   1      
 128   1        if((*(real_data+1)>>8)>9)//å¦‚æœä¸»ç‰ˆæœ¬å·å¤§äº9
 129   1        {
 130   2          disbuf[8]=(*(real_data+1)>>8)/10+48;
 131   2          disbuf[9]=(*(real_data+1)>>8)%10+48;
 132   2        }
 133   1        else
 134   1        {
 135   2          disbuf[8]= '0';
 136   2          disbuf[9]=(*(real_data+1)>>8)+48;
 137   2        } 
 138   1        disbuf[10]='"';
 139   1      
 140   1        while(*cmd_buf!='\0')
 141   1        {
 142   2          cmd_buf++;
 143   2          cmd_len++;
 144   2        }
 145   1      
 146   1        UART2_Send((uchar *)cmd,cmd_len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
 147   1        
 148   1        if(*(real_data)==0 && *(real_data+1)==0)
 149   1        UART2_Send((uchar *)"\"no device\"",11);
 150   1        else
 151   1        UART2_Send(disbuf,11);//å‘é€å€¼ 
 152   1        
 153   1        UART2_Send(end_frame,3);//å¸§å°¾éƒ¨
 154   1       
 155   1        while(clear_data--)
 156   1        {
 157   2          *real_data=0x0000;
 158   2          real_data++;
 159   2        }  
 160   1        return TRUE;    
 161   1        
 162   1      }
 163          
 164          int ultrasonic_window(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 165          {        
 166   1         uchar clear_data=50; 
 167   1      
 168   1         send_data(0x81,0x80,27); 
 169   1         delayms(30);
 170   1         Lcd_set_val("d0.val=",(*(real_data+chaosheng1) >> 8)*10);
 171   1         Lcd_set_val("d2.val=",(*(real_data+chaosheng1) & 0x00ff)*10);
 172   1         Lcd_set_val("d4.val=",(*(real_data+chaosheng2) >>8)*10);
 173   1         Lcd_set_val("d6.val=",(*(real_data+chaosheng2) & 0x00ff)*10);
 174   1         Lcd_set_val("d8.val=",(*(real_data+chaosheng3) >> 8)*10);
 175   1         Lcd_set_val("da.val=",(*(real_data+chaosheng3) & 0x00ff)*10);
 176   1         Lcd_set_val("dc.val=",(*(real_data+chaosheng4) >> 8)*10);
 177   1         Lcd_set_val("de.val=",(*(real_data+chaosheng4) & 0x00ff)*10);
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 4   

 178   1         Lcd_set_val("e0.val=",(*(real_data+chaosheng5) >> 8)*10);
 179   1         Lcd_set_val("e2.val=",(*(real_data+chaosheng5) & 0x00ff)*10);
 180   1         Lcd_set_val("e4.val=",(*(real_data+chaosheng6) >> 8)*10);
 181   1         Lcd_set_val("e8.val=",(*(real_data+chaosheng6) & 0x00ff)*10);
 182   1         Lcd_set_val("hongwaizuo.val=",(*(real_data+hongwai2) >> 8)*2);
 183   1         Lcd_set_val("hongwaiyou.val=",(*(real_data+hongwai2) & 0x00ff)*2);
 184   1         
 185   1         //è¯»å–ç‰ˆæœ¬å·
 186   1         send_data(0x81,0xCA,2); 
 187   1         delayms(30);    
 188   1         Lcd_set_txt("val1.txt=",real_data);//0å·æ¿
 189   1         send_data(0x81,0xCC,2); 
 190   1         delayms(30);  
 191   1         Lcd_set_txt("val2.txt=",real_data);//1å·æ¿
 192   1         send_data(0x81,0xCE,2); 
 193   1         delayms(30);  
 194   1         Lcd_set_txt("val3.txt=",real_data);//2å·æ¿
 195   1         send_data(0x81,0xD0,2); 
 196   1         delayms(30);  
 197   1         Lcd_set_txt("val4.txt=",real_data);//3å·æ¿
 198   1         
 199   1         while(clear_data--)
 200   1         {
 201   2          *real_data=0x0000;
 202   2          real_data++;
 203   2         }
 204   1        
 205   1         if(lcd_status==Return_button)
 206   1         {
 207   2              Lcd_control("page main");
 208   2              lcd_status = main_window;
 209   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 210   2         }
 211   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 212   1      }
 213          int ultrasonic_window1(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 214          {        
 215   1         uchar clear_data=50; 
 216   1      
 217   1         send_data(0x81,0x8b,16); 
 218   1         delayms(30);
 219   1         Lcd_set_val("d0.val=",(*(real_data) >> 8)*10);
 220   1         Lcd_set_val("d1.val=",(*(real_data) & 0x00ff)*10);
 221   1         Lcd_set_val("d2.val=",(*(real_data+1) >>8)*10);
 222   1         Lcd_set_val("d3.val=",(*(real_data+1) & 0x00ff)*10);
 223   1         Lcd_set_val("d4.val=",(*(real_data+2) >> 8)*10);
 224   1         Lcd_set_val("d5.val=",(*(real_data+2) & 0x00ff)*10);
 225   1         Lcd_set_val("d6.val=",(*(real_data+3) >> 8)*10);
 226   1         Lcd_set_val("d7.val=",(*(real_data+3) & 0x00ff)*10);
 227   1         Lcd_set_val("d8.val=",(*(real_data+4) >> 8)*10);
 228   1         Lcd_set_val("d9.val=",(*(real_data+4) & 0x00ff)*10);
 229   1         Lcd_set_val("d10.val=",(*(real_data+5) >> 8)*10);
 230   1         //Lcd_set_val("e8.val=",(*(real_data+5) & 0x00ff)*10);
 231   1         Lcd_set_val("hongwaizuo.val=",(*(real_data+6) & 0x00ff)*2);
 232   1         Lcd_set_val("hongwaiyou.val=",(*(real_data+7) & 0x00ff)*2);
 233   1         
 234   1         /*/è¯»å–ç‰ˆæœ¬å·
 235   1         send_data(0x81,0xCA,2); 
 236   1         delayms(30);    
 237   1         Lcd_set_txt("val1.txt=",real_data);//0å·æ¿
 238   1         send_data(0x81,0xCC,2); 
 239   1         delayms(30);  
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 5   

 240   1         Lcd_set_txt("val2.txt=",real_data);//1å·æ¿
 241   1         send_data(0x81,0xCE,2); 
 242   1         delayms(30);  
 243   1         Lcd_set_txt("val3.txt=",real_data);//2å·æ¿
 244   1         send_data(0x81,0xD0,2); 
 245   1         delayms(30);  
 246   1         Lcd_set_txt("val4.txt=",real_data);//3å·æ¿
 247   1         */
 248   1         
 249   1         //è¶…å£°æ³¢1
 250   1         send_data(0x81,0xcc,3);
 251   1         delayms(30);
 252   1         Lcd_set_txt("chaosheng1.txt=",real_data);
 253   1          //è¶…å£°æ³¢2
 254   1         send_data(0x81,0xcf,3);
 255   1         delayms(30);
 256   1         Lcd_set_txt("chaosheng2.txt=",real_data);
 257   1            
 258   1         while(clear_data--)
 259   1         {
 260   2          *real_data=0x0000;
 261   2          real_data++;
 262   2         }
 263   1        
 264   1         if(lcd_status==Return_button1)
 265   1         {
 266   2              Lcd_control("page main1");
 267   2              lcd_status = main_window;
 268   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 269   2         }
 270   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 271   1      }
 272          
 273          
 274          
 275          int version_window(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 276          {        
 277   1             TH1 = 0xf7;  
 278   1             TL1 = TH1; //38400æ³¢ç‰¹ç‡ 
 279   1             delayms(30);
 280   1             //ç”µæºç®¡ç†æ¿
 281   1            send_data(0x05,0x78,3);
 282   1            delayms(30);
 283   1            Lcd_set_txt("dianyuanguanli.txt=",real_data);
 284   1            //èˆµæœºæ¿
 285   1            send_data(0x01,0x78,3);
 286   1            delayms(30);
 287   1            Lcd_set_txt("tou_duoji.txt=",real_data);
 288   1            //å•æµ‹å³è½®
 289   1            send_data(0x02,0x78,3);
 290   1            delayms(30);
 291   1            Lcd_set_txt("danyoulun.txt=",real_data);
 292   1            //å·¦æ‰‹
 293   1            send_data(0x06,0x78,3);
 294   1            delayms(30);
 295   1            Lcd_set_txt("zuoshou.txt=",real_data);
 296   1            //å³æ‰‹
 297   1            send_data(0x07,0x78,3);
 298   1            delayms(30);
 299   1            Lcd_set_txt("youshou.txt=",real_data);
 300   1            //å¤´å‘¼å¸ç¯æ¿
 301   1            send_data(0x03,0x78,3);
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 6   

 302   1            delayms(30);
 303   1            Lcd_set_txt("tou_led.txt=",real_data);
 304   1            
 305   1            TH1 = 0xFD;   
 306   1            TL1 = TH1;  //115200æ³¢ç‰¹ç‡ 
 307   1            //ä¸»æ§æ¿
 308   1            send_data(0x81,0x78,3);
 309   1            delayms(30);
 310   1            Lcd_set_txt("zhukong.txt=",real_data);
 311   1            //è¶…å®½å¸¦
 312   1            send_data(0x81,0xB1,3);
 313   1            delayms(30);
 314   1            Lcd_set_txt("chaokuandai.txt=",real_data);      
 315   1            //å·¦è½®
 316   1            send_data(0x81,0xB4,3);
 317   1            delayms(30);
 318   1            Lcd_set_txt("zuolun.txt=",real_data);    
 319   1            //å³è½®
 320   1            send_data(0x81,0xB7,3);
 321   1            delayms(30);
 322   1            Lcd_set_txt("youlun.txt=",real_data);
 323   1            
 324   1           if(lcd_status==Return_button)
 325   1           {
 326   2              Lcd_control("page main");
 327   2              lcd_status = main_window;
 328   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 329   2           }
 330   1         
 331   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 332   1      }
 333          int version_window1(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 334          {        
 335   1             /*TH1 = 0xf7;  
 336   1             TL1 = TH1; //38400æ³¢ç‰¹ç‡ 
 337   1             delayms(30);
 338   1      
 339   1            //å•æµ‹å·¦è½®
 340   1            send_data(0x01,0x78,3);
 341   1            delayms(30);
 342   1            Lcd_set_txt("danzuolun.txt=",real_data);
 343   1            //å•æµ‹å³è½®
 344   1            send_data(0x02,0x78,3);
 345   1            delayms(30);
 346   1            Lcd_set_txt("danyoulun.txt=",real_data);*/
 347   1        
 348   1            //ä¸»æ§æ¿
 349   1            send_data(0x81,0x78,3);
 350   1            delayms(30);
 351   1            Lcd_set_txt("zhukong.txt=",real_data);
 352   1            //è¶…å®½å¸¦
 353   1            send_data(0x81,0xc0,3);
 354   1            delayms(30);
 355   1            Lcd_set_txt("chaokuandai.txt=",real_data);      
 356   1            //å·¦è½®
 357   1            send_data(0x81,0xc6,3);
 358   1            delayms(30);
 359   1            Lcd_set_txt("zuolun.txt=",real_data);    
 360   1            //å³è½®
 361   1            send_data(0x81,0xc9,3);
 362   1            delayms(30);
 363   1            Lcd_set_txt("youlun.txt=",real_data);
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 7   

 364   1            //ç”µæºç®¡ç†
 365   1            send_data(0x81,0xc3,3);
 366   1            delayms(30);
 367   1            Lcd_set_txt("dianyuanguanli.txt=",real_data);   
 368   1            //è¶…å£°æ³¢1
 369   1            send_data(0x81,0xcc,3);
 370   1            delayms(30);
 371   1            Lcd_set_txt("chaosheng1.txt=",real_data);
 372   1            //è¶…å£°æ³¢2
 373   1            send_data(0x81,0xcf,3);
 374   1            delayms(30);
 375   1            Lcd_set_txt("chaosheng2.txt=",real_data);
 376   1            
 377   1            //èˆµæœºæ¿
 378   1            send_data(0x82,0x70,3);
 379   1            delayms(30);
 380   1            Lcd_set_txt("tou_duoji.txt=",real_data);
 381   1            delayms(30);
 382   1            
 383   1            //é©±åŠ¨å™¨é€‰æ‹©
 384   1            if(lcd_status==feng_de_kong)//é£å¾—æ§
 385   1            {
 386   2              main_board_single_write(0x0f,0x047f);//ä¸»æ§æ¿å•å†™   
 387   2              delayms(30);  
 388   2              main_board_single_write(0x09,0x5a5a);//å†™å…¥flash  
 389   2              delayms(200); 
 390   2              main_board_single_write(0x5a,0x5555);//é‡å¯ä¸»æ§æ¿
 391   2              delayms(30);
 392   2              qu_dong_qi=1;
 393   2              lcd_status=0;       
 394   2            } 
 395   1            if(lcd_status==yi_ban_qudong)//ä¸€èˆ¬3ä»£é©±åŠ¨
 396   1            {
 397   2              main_board_single_write(0x0f,0x007f);//ä¸»æ§æ¿å•å†™   
 398   2              delayms(30);  
 399   2              main_board_single_write(0x09,0x5a5a);//å†™å…¥flash  
 400   2              delayms(200); 
 401   2              main_board_single_write(0x5a,0x5555);//é‡å¯ä¸»æ§æ¿
 402   2              delayms(30);
 403   2              qu_dong_qi=0;
 404   2              lcd_status=0;       
 405   2            }       
 406   1           if(lcd_status==Return_button1)
 407   1           {
 408   2              Lcd_control("page main1");
 409   2              lcd_status = main_window;
 410   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 411   2           }
 412   1         
 413   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 414   1      }
 415          
 416          int motor_ctrl_window(unsigned short *real_data)//èˆµæœºæ§åˆ¶çª—å£
 417          {        
 418   1               
 419   1            uchar turn_speed = 10;
 420   1            send_data(0x01,0x7e,2);
 421   1            delayms(30);
 422   1            Lcd_set_val("hbianmaqiz.val=", (int)(*(real_data)));
 423   1            delayms(30);
 424   1            Lcd_set_val("hbiaodingz.val=", (int)(*(real_data+1)));
 425   1            *(real_data)=0;
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 8   

 426   1            *(real_data+1)=0;
 427   1      
 428   1            send_data(0x06,0x7e,2);
 429   1            delayms(30);
 430   1            Lcd_set_val("zbianmaqiz.val=", (int)(*(real_data)));
 431   1            delayms(30);
 432   1            Lcd_set_val("zbiaodingz.val=", (int)(*(real_data+1)));
 433   1            *(real_data)=0;
 434   1            *(real_data+1)=0;
 435   1      
 436   1            send_data(0x07,0x7e,2);
 437   1            delayms(30);
 438   1            Lcd_set_val("ybianmaqiz.val=", (int)(*(real_data)));
 439   1            delayms(30);
 440   1            Lcd_set_val("ybiaodingz.val=", (int)(*(real_data+1)));
 441   1            *(real_data)=0;
 442   1            *(real_data+1)=0;
 443   1            //*å¤´éƒ¨æ§åˆ¶éƒ¨åˆ†
 444   1            if(lcd_status==hbiaoding)//å¤´éƒ¨æ ‡å®šæ£€æµ‹
 445   1            {
 446   2              motor_contrl_send(0x01,0x05,0,0);
 447   2              delayms(30);
 448   2              motor_contrl_send(0x01,0x05,0,0);
 449   2              delayms(30);         
 450   2              motor_contrl_send(0x01,0x00,0,0);
 451   2            }
 452   1            if(lcd_status==hzuo)//å¤´éƒ¨æ­£è½¬
 453   1            {
 454   2              motor_contrl_send(0x01,0x01,turn_speed,0);    
 455   2            }
 456   1            if(lcd_status==hyou)//å¤´éƒ¨åè½¬
 457   1            {
 458   2              motor_contrl_send(0x01,0x02,turn_speed,0);        
 459   2            }
 460   1            if(lcd_status==hzhong)//å¤´éƒ¨æ­£ä¸­
 461   1            {
 462   2              motor_contrl_send( 0x01,0x03,turn_speed,180);
 463   2              delayms(2000);
 464   2              motor_contrl_send( 0x01,0x00,0,0);        
 465   2            }//*/
 466   1      
 467   1            //å·¦æ‰‹æ§åˆ¶éƒ¨åˆ†
 468   1            if(lcd_status==zbiaoding)//å·¦æ‰‹æ ‡å®šæ£€æµ‹
 469   1            {
 470   2              motor_contrl_send( 0x06,0x05,0,0);
 471   2              delayms(30);
 472   2              motor_contrl_send( 0x06,0x05,0,0);
 473   2              delayms(30);         
 474   2              motor_contrl_send( 0x06,0x00,0,0);//é€€å‡ºæ ‡å®šçŠ¶æ€
 475   2            }
 476   1            if(lcd_status==zzuo)//å·¦æ‰‹æ­£è½¬
 477   1            {
 478   2              motor_contrl_send( 0x06,0x01,7,0);    
 479   2            }
 480   1            if(lcd_status==zyou)//å·¦æ‰‹åè½¬
 481   1            {
 482   2              motor_contrl_send( 0x06,0x02,7,0);        
 483   2            }
 484   1            if(lcd_status==zzhong)//å·¦æ‰‹æ­£ä¸­
 485   1            {
 486   2              motor_contrl_send( 0x06,0x03,7,180);
 487   2              delayms(2000);
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 9   

 488   2              motor_contrl_send( 0x06,0x00,0,0);        
 489   2            }
 490   1      
 491   1            //*å³æ‰‹æ§åˆ¶éƒ¨åˆ†
 492   1            if(lcd_status==ybiaoding)//å·¦æ‰‹æ ‡å®šæ£€æµ‹
 493   1            {
 494   2              motor_contrl_send( 0x07,0x05,0,0);
 495   2              delayms(30);
 496   2              motor_contrl_send( 0x07,0x05,0,0);
 497   2              delayms(30);         
 498   2              motor_contrl_send( 0x07,0x00,0,0);//é€€å‡ºæ ‡å®šçŠ¶æ€
 499   2            }
 500   1            if(lcd_status==yzuo)//å·¦æ‰‹æ­£è½¬
 501   1            {
 502   2              ////printf("yzuo\n");
 503   2              motor_contrl_send( 0x07,0x01,7,0);    
 504   2            }
 505   1            if(lcd_status==yyou)//å·¦æ‰‹åè½¬
 506   1            {
 507   2              ////printf("yyou\n");
 508   2              motor_contrl_send( 0x07,0x02,7,0);        
 509   2            }
 510   1            if(lcd_status==yzhong)//å·¦æ‰‹æ­£ä¸­
 511   1            {
 512   2              ////printf("yzhong\n");
 513   2              motor_contrl_send( 0x07,0x03,7,180);
 514   2              delayms(2000);
 515   2              motor_contrl_send( 0x07,0x00,0,0);        
 516   2            }
 517   1      
 518   1            //LEDç¯æ¿æ§åˆ¶éƒ¨åˆ†
 519   1            if(lcd_status==led00)
 520   1            {
 521   2              //printf("led00\n");
 522   2              led_contrl_send( 0x03,0,0,100);
 523   2            }
 524   1            if(lcd_status==led01)
 525   1            {
 526   2              //printf("led01\n");
 527   2              led_contrl_send( 0x03,0,35,100);
 528   2            }
 529   1            if(lcd_status==led10)
 530   1            {
 531   2              //printf("led10\n");
 532   2              led_contrl_send( 0x03,35,0,100);
 533   2            }
 534   1            if(lcd_status==led11)
 535   1            {
 536   2              //printf("led11\n");
 537   2              led_contrl_send( 0x03,35,35,100);
 538   2            }
 539   1      
 540   1            //è¿ç»­æ§åˆ¶éƒ¨åˆ†
 541   1            if(lcd_status==alianxu1)
 542   1            {
 543   2              //printf("alianxu1\n");
 544   2              while(1)
 545   2              {
 546   3                motor_contrl_send( 0x01,0x01,9,0);//å¤´éƒ¨æ­£è½¬
 547   3                delayms(30);
 548   3                motor_contrl_send( 0x06,0x01,7,0);//å·¦æ‰‹æ­£è½¬ 
 549   3                delayms(30);
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 10  

 550   3                motor_contrl_send( 0x07,0x01,7,0);//å³æ‰‹æ­£è½¬ 
 551   3                delayms(30);
 552   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹
 553   3                if(lcd_status==Return_button) break;
 554   3                delayms(3500);
 555   3                if(lcd_status==Return_button) break;
 556   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹     
 557   3                motor_contrl_send( 0x01,0x02,9,0);//å¤´éƒ¨åè½¬       
 558   3                delayms(30);
 559   3                motor_contrl_send( 0x06,0x02,7,0);//å·¦æ‰‹åè½¬
 560   3                delayms(30);
 561   3                if(lcd_status==Return_button) break;
 562   3                motor_contrl_send( 0x07,0x02,7,0);//å³æ‰‹åè½¬
 563   3                delayms(30);
 564   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹     
 565   3                delayms(3500);
 566   3                if(lcd_status==Return_button) break;
 567   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹       
 568   3              }
 569   2              //printf("alianxu0\n");
 570   2              //é€€å‡ºå›æ­£
 571   2              motor_contrl_send( 0x01,0x03,9,180);//å¤´å›æ­£
 572   2              delayms(30);
 573   2              motor_contrl_send( 0x06,0x03,7,180);//å·¦æ‰‹å›æ­£
 574   2              delayms(30);
 575   2              motor_contrl_send( 0x07,0x03,7,180);//å³æ‰‹å›æ­£
 576   2              delayms(30);
 577   2              delayms(2000);//ç­‰å¾…å›æ­£å®Œæ¯•
 578   2      
 579   2              //é€€å‡ºåè®¾ç½®ä¸ºè‡ªç„¶åœæ­¢
 580   2              motor_contrl_send( 0x01,0x00,0,0);//å¤´åœæ­¢ 
 581   2              delayms(30);
 582   2              motor_contrl_send( 0x06,0x00,0,0);//å·¦æ‰‹åœæ­¢ 
 583   2              delayms(30);
 584   2              motor_contrl_send( 0x07,0x00,0,0);//å³æ‰‹åœæ­¢
 585   2              delayms(30);      
 586   2            }//*/
 587   1      
 588   1           if(lcd_status==Return_button)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 589   1           {
 590   2              //printf("return_button\n");
 591   2              Lcd_control( "page main");
 592   2              lcd_status = main_window;
 593   2              //é€€å‡ºå›æ­£
 594   2              motor_contrl_send( 0x01,0x03,9,180);//å¤´å›æ­£
 595   2              delayms(30);
 596   2              motor_contrl_send( 0x06,0x03,7,180);//å·¦æ‰‹å›æ­£
 597   2              delayms(30);
 598   2              motor_contrl_send( 0x07,0x03,7,180);//å³æ‰‹å›æ­£
 599   2              delayms(30);
 600   2              delayms(2000);//ç­‰å¾…å›æ­£å®Œæ¯•
 601   2              //é€€å‡ºåè®¾ç½®ä¸ºè‡ªç„¶åœæ­¢
 602   2              motor_contrl_send( 0x01,0x00,0,0);//å¤´åœæ­¢ 
 603   2              delayms(30);
 604   2              motor_contrl_send( 0x06,0x00,0,0);//å·¦æ‰‹åœæ­¢ 
 605   2              delayms(30);
 606   2              motor_contrl_send( 0x07,0x00,0,0);//å³æ‰‹åœæ­¢
 607   2              delayms(30); 
 608   2      
 609   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 610   2           }
 611   1      
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 11  

 612   1           lcd_status=0;//çŠ¶æ€æ¸…é›¶
 613   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 614   1      }
 615          
 616          
 617          //*
 618          
 619          int motor_ctrl_window1(unsigned short *real_data)//èˆµæœºæ§åˆ¶çª—å£
 620          {        
 621   1               
 622   1            uchar turn_speed = 15;//15æœ€å¤§å€¼
 623   1            int head_angle=0,left_angle=0,right_angle=0;
 624   1            //*ç”¨äºå¿ƒè·³æ£€æµ‹é—´éš”
 625   1            send_data(0x82,0x70,3);
 626   1            delayms(200); //*/
 627   1            //å¤´éƒ¨æ§åˆ¶éƒ¨åˆ†  
 628   1            if(lcd_status==hbiaoding)//æ ‡å®šæ£€æµ‹
 629   1            {
 630   2              motor_contrl_send1(0x05,0x01,0,0);//å¤´æ ‡å®š
 631   2              delayms(30);
 632   2              motor_contrl_send1(0x16,0x05,0,0);//å·¦æ‰‹æ ‡å®š
 633   2              delayms(30);         
 634   2              motor_contrl_send1(0x22,0x05,0,0);//å³æ‰‹æ ‡å®š
 635   2            }
 636   1            if(lcd_status==hzuo)//å¤´éƒ¨æ­£è½¬
 637   1            {
 638   2              motor_contrl_send1(0x05,0x04,turn_speed,0);    
 639   2            }
 640   1            if(lcd_status==hyou)//å¤´éƒ¨åè½¬
 641   1            {
 642   2              motor_contrl_send1(0x05,0x04,turn_speed,180);        
 643   2            }
 644   1            if(lcd_status==hzhong)//å¤´éƒ¨æ­£ä¸­
 645   1            {
 646   2              motor_contrl_send1( 0x05,0x04,turn_speed,90);      
 647   2            }
 648   1      
 649   1            //å·¦æ‰‹æ§åˆ¶éƒ¨åˆ†
 650   1            if(lcd_status==zzuo)//å·¦æ‰‹æ­£è½¬
 651   1            {
 652   2              motor_contrl_send1( 0x16,0x03,turn_speed,360);    
 653   2            }
 654   1            if(lcd_status==zyou)//å·¦æ‰‹åè½¬
 655   1            {
 656   2              motor_contrl_send1( 0x16,0x03,turn_speed,120);        
 657   2            }
 658   1            if(lcd_status==zzhong)//å·¦æ‰‹æ­£ä¸­
 659   1            {
 660   2              motor_contrl_send1( 0x16,0x03,turn_speed,180);     
 661   2            }
 662   1      
 663   1            //*å³æ‰‹æ§åˆ¶éƒ¨åˆ†
 664   1            if(lcd_status==yzuo)//æ­£è½¬
 665   1            {
 666   2              motor_contrl_send1( 0x22,0x03,turn_speed,360);    
 667   2            }
 668   1            if(lcd_status==yyou)//åè½¬
 669   1            {
 670   2              motor_contrl_send1( 0x22,0x03,turn_speed,120);        
 671   2            }
 672   1            if(lcd_status==yzhong)//æ­£ä¸­
 673   1            {
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 12  

 674   2              motor_contrl_send1( 0x22,0x03,turn_speed,180);     
 675   2            }
 676   1      
 677   1            //LEDç¯æ¿æ§åˆ¶éƒ¨åˆ†
 678   1            if(lcd_status==led00)//å…³é—­
 679   1            {
 680   2              led_contrl_send1( 0x00,0,0,0);
 681   2            }
 682   1            if(lcd_status==led01)//çº¢
 683   1            {
 684   2              led_contrl_send1( 0x01,255,0,0);
 685   2            }
 686   1            if(lcd_status==led10)//ç»¿
 687   1            {       
 688   2              led_contrl_send1( 0x01,0,255,0);
 689   2            }
 690   1            if(lcd_status==led11)//è“
 691   1            {
 692   2              led_contrl_send1( 0x01,0,0,255);
 693   2            }
 694   1      
 695   1            //è¿ç»­æ§åˆ¶éƒ¨åˆ†
 696   1            if(lcd_status==alianxu1)
 697   1            {
 698   2              motor_contrl_send1( 0x05,0x04,turn_speed,0);//å¤´éƒ¨æ­£è½¬
 699   2              delayms(30);
 700   2              motor_contrl_send1( 0x16,0x03,turn_speed,360);//å·¦æ‰‹æ­£è½¬ 
 701   2              delayms(30);
 702   2              motor_contrl_send1( 0x22,0x03,turn_speed,360);//å³æ‰‹æ­£è½¬ 
 703   2              while(1)
 704   2              {       
 705   3                send_data(0x82,0x74,11);
 706   3                delayms(30);
 707   3                head_angle=(int)(*(real_data));
 708   3                left_angle=(int)(*(real_data+5));
 709   3                right_angle=(int)(*(real_data+10));
 710   3                
 711   3                if(head_angle>=0&&head_angle<=2)
 712   3                {
 713   4                   motor_contrl_send1( 0x05,0x04,turn_speed,180);//å¤´éƒ¨åè½¬
 714   4                   delayms(30);
 715   4                }
 716   3                if(head_angle>=178&&head_angle<=180)
 717   3                {
 718   4                   motor_contrl_send1( 0x05,0x04,turn_speed,0);//å¤´éƒ¨æ­£è½¬ 
 719   4                   delayms(30);           
 720   4                }
 721   3      
 722   3                //å·¦æ‰‹
 723   3                if(left_angle>=358&&left_angle<=360||left_angle>=0&&left_angle<=2)
 724   3                {
 725   4                motor_contrl_send1( 0x16,0x03,turn_speed,120);//å·¦æ‰‹åè½¬ 
 726   4                   delayms(30);
 727   4                }
 728   3                if(left_angle>=117&&left_angle<=122)
 729   3                {
 730   4                   motor_contrl_send1( 0x16,0x03,turn_speed,360);//å·¦æ‰‹æ­£è½¬ 
 731   4                   delayms(30);           
 732   4                } 
 733   3                //å³æ‰‹
 734   3                if(right_angle>=358&&right_angle<=360||right_angle>=0&&right_angle<=2)
 735   3                {
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 13  

 736   4                 motor_contrl_send1( 0x22,0x03,turn_speed,120);//å³æ‰‹åè½¬ 
 737   4                   delayms(30);
 738   4                }
 739   3                if(right_angle>=117&&right_angle<=122)
 740   3                {
 741   4                   motor_contrl_send1( 0x22,0x03,turn_speed,360);//å³æ‰‹æ­£è½¬ 
 742   4                   delayms(30);           
 743   4                }           
 744   3      
 745   3                if(lcd_status==Return_button1) break;
 746   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹     
 747   3                delayms(200);
 748   3              }
 749   2      
 750   2              //é€€å‡ºå›æ­£
 751   2      
 752   2              motor_contrl_send1( 0x16,0x03,turn_speed,180);//å·¦æ‰‹å›æ­£
 753   2              delayms(30);
 754   2              motor_contrl_send1( 0x22,0x03,turn_speed,180);//å³æ‰‹å›æ­£
 755   2              delayms(30);
 756   2              motor_contrl_send1( 0x05,0x04,turn_speed,90);//å¤´å›æ­£
 757   2              delayms(30);        
 758   2      
 759   2         
 760   2            }
 761   1      
 762   1           if(lcd_status==Return_button1)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 763   1           {
 764   2              //printf("return_button\n");
 765   2              Lcd_control( "page main1");
 766   2              lcd_status = main_window;
 767   2              //é€€å‡ºå›æ­£
 768   2              motor_contrl_send1( 0x05,0x04,turn_speed,90);//å¤´å›æ­£
 769   2              delayms(30);
 770   2              motor_contrl_send1( 0x16,0x03,turn_speed,180);//å·¦æ‰‹å›æ­£
 771   2              delayms(30);
 772   2              motor_contrl_send1( 0x22,0x03,turn_speed,180);//å³æ‰‹å›æ­£
 773   2      
 774   2      
 775   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 776   2           }
 777   1      
 778   1          lcd_status=0;//çŠ¶æ€æ¸…é›¶
 779   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 780   1      }
 781          
 782          
 783          int Duojixianzhi_window(unsigned short *real_data)//èˆµæœºé™åˆ¶çª—å£
 784          {                
 785   1            //å¤´éƒ¨é™åˆ¶æŸ¥è¯¢
 786   1            send_data(0x01,0x80,1);//è¯»é™å®šç”µæµå€¼
 787   1            delayms(30);
 788   1            Lcd_set_val("htouxianliu.val=", *(real_data));
 789   1            delayms(30);
 790   1            *(real_data)=0;
 791   1        
 792   1            send_data(0x01,0x0B,2);//è¯»é™ä½å€¼
 793   1            delayms(30);
 794   1            Lcd_set_val("htoushangxw.val=", (int)(*(real_data)));
 795   1            delayms(30);
 796   1            Lcd_set_val("htouxiaxw.val=", (int)(*(real_data+1)));
 797   1            *(real_data)=0;
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 14  

 798   1            *(real_data+1)=0;
 799   1      
 800   1            //ä¿¯ä»°é™åˆ¶æŸ¥è¯¢
 801   1            send_data(0x02,0x80,1);//è¯»é™å®šç”µæµå€¼
 802   1            delayms(30);
 803   1            Lcd_set_val("fyxianliu.val=", *(real_data));
 804   1            delayms(30);
 805   1            *(real_data)=0;
 806   1        
 807   1            send_data(0x02,0x0B,2);//è¯»é™ä½å€¼
 808   1            delayms(30);
 809   1            Lcd_set_val("fyshangxianw.val=", (int)(*(real_data)));
 810   1            delayms(30);
 811   1            Lcd_set_val("fyxiaxianw.val=", (int)(*(real_data+1)));
 812   1            *(real_data)=0;
 813   1            *(real_data+1)=0;
 814   1      
 815   1            //å·¦æ‰‹é™åˆ¶æŸ¥è¯¢
 816   1            send_data(0x06,0x80,1);//è¯»é™å®šç”µæµå€¼
 817   1            delayms(30);
 818   1            Lcd_set_val("zuoxianliu.val=", *(real_data));
 819   1            delayms(30);
 820   1            *(real_data)=0;
 821   1        
 822   1            send_data(0x06,0x0B,2);//è¯»é™ä½å€¼
 823   1            delayms(30);
 824   1            Lcd_set_val("zuoshangxw.val=", (int)(*(real_data)));
 825   1            delayms(30);
 826   1            Lcd_set_val("zuoxiaxw.val=", (int)(*(real_data+1)));
 827   1            *(real_data)=0;
 828   1            *(real_data+1)=0;
 829   1            
 830   1            //å³æ‰‹é™åˆ¶æŸ¥è¯¢
 831   1            send_data(0x07,0x80,1);//è¯»é™å®šç”µæµå€¼
 832   1            delayms(30);
 833   1            Lcd_set_val("yshouxianliu.val=", *(real_data));
 834   1            delayms(30);
 835   1            *(real_data)=0;
 836   1        
 837   1            send_data(0x07,0x0B,2);//è¯»é™ä½å€¼
 838   1            delayms(30);
 839   1            Lcd_set_val("yshoushangxw.val=", (int)(*(real_data)));
 840   1            delayms(30);
 841   1            Lcd_set_val("yshaouxiaxw.val=", (int)(*(real_data+1)));
 842   1            *(real_data)=0;
 843   1            *(real_data+1)=0;     
 844   1            
 845   1            //*ä¸€é”®é™åˆ¶é…ç½®éƒ¨åˆ†
 846   1            if(lcd_status==set_limit_value)
 847   1            {
 848   2              //å¤´éƒ¨èˆµæœº 
 849   2              limit_current_contrl_send(0x01,10);//å¤´0.6Açš„é™åˆ¶ç”µæµ
 850   2              delayms(30);
 851   2              limit_value_contrl_send(0x01 ,90,90);//å¤´90åº¦é™ä½å€¼å‘é€
 852   2              delayms(30);
 853   2              //ä¿¯ä»°èˆµæœº        
 854   2              limit_current_contrl_send(0x02,10);//ä¿¯ä»°0.6Açš„é™åˆ¶ç”µæµ
 855   2              delayms(30);
 856   2              limit_value_contrl_send(0x02 ,9,9);//å¹³å®‰ä¿¯ä»°9åº¦é™ä½å€¼å‘é€
 857   2              delayms(30);
 858   2              //å·¦æ‰‹èˆµæœº 
 859   2              limit_current_contrl_send(0x06,10);//å¤´1Açš„é™åˆ¶ç”µæµ
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 15  

 860   2              delayms(30);
 861   2              limit_value_contrl_send(0x06 ,90,90);//å¤´90åº¦é™ä½å€¼å‘é€
 862   2              delayms(30);
 863   2              //å³æ‰‹èˆµæœº        
 864   2              limit_current_contrl_send(0x07,10);//ä¿¯ä»°1Açš„é™åˆ¶ç”µæµ
 865   2              delayms(30);
 866   2              limit_value_contrl_send(0x07 ,90,90);//ä¿¯ä»°90åº¦é™ä½å€¼å‘é€
 867   2              delayms(30);          
 868   2            }
 869   1      
 870   1           if(lcd_status==Return_button)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 871   1           {
 872   2              //printf("return_button\n");
 873   2              Lcd_control( "page main");
 874   2              lcd_status = main_window;
 875   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 876   2           }
 877   1      
 878   1           lcd_status=0;//çŠ¶æ€æ¸…é›¶
 879   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 880   1      }
 881          
 882          int biaoqing_window(void)//è¡¨æƒ…çª—å£
 883          {                
 884   1            switch(lcd_status)
 885   1            {
 886   2              case zhengchang: biao_qing_contrl_send(0);break;
 887   2              case aixin: biao_qing_contrl_send(145);break;
 888   2              case chongdian: biao_qing_contrl_send(257);break;
 889   2              case daohang: biao_qing_contrl_send(277);break;
 890   2              default : break;
 891   2            }
 892   1      
 893   1           if(lcd_status==Return_button1)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 894   1           {
 895   2              //printf("return_button\n");
 896   2              Lcd_control( "page main1");
 897   2              lcd_status = main_window;
 898   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 899   2           }
 900   1      
 901   1           lcd_status=0;//çŠ¶æ€æ¸…é›¶
 902   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 903   1      }
 904          
 905          
 906          //void main_board_contrl_send(uchar run_mode,uchar left_speed,uchar right_speed);//ä¸»æ§æ¿å¤šå†™
 907          int robot_ctrl_window(unsigned short *real_data)//æ•´æœºæ§åˆ¶éƒ¨åˆ†
 908          {        
 909   1            *real_data = 0xf1f0;  
 910   1             switch(lcd_status)
 911   1             {
 912   2                case auto_charge_on : main_board_contrl_send(0x80,0,0);  break;
 913   2                case auto_charge_off : main_board_contrl_send(0x00,0,0);  break;
 914   2                case go_up : main_board_contrl_send(0x01,40,40);  break;
 915   2                case go_down : main_board_contrl_send(0x02,40,40); break;
 916   2                case go_left : main_board_contrl_send(0x04,0,25); break;
 917   2                case go_right : main_board_contrl_send(0x03,25,0); break;
 918   2                case go_stop : main_board_contrl_send(0x05,0,0); //è¢«åŠ¨åˆ¹è½¦
 919   2                               delayms(30);
 920   2                               main_board_contrl_send(0x00,0,0); //ç©ºæŒ¡æ— é˜»åŠ›
 921   2                               break;
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 16  

 922   2                 default :break;
 923   2              }
 924   1          
 925   1           if(lcd_status==Return_button)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 926   1           {
 927   2              //printf("return_button\n");
 928   2              Lcd_control( "page main");
 929   2              lcd_status = main_window;
 930   2              main_board_contrl_send(0x05,0,0); //è¢«åŠ¨åˆ¹è½¦
 931   2              delayms(30);
 932   2              main_board_contrl_send(0x00,0,0); //ç©ºæŒ¡æ— é˜»åŠ›
 933   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 934   2           }
 935   1           delayms(10);
 936   1           send_data(0x81,0x88,1); //å‘é€æŸ¥è¯¢å®šä½çŠ¶æ€æŒ‡ä»¤
 937   1           delayms(30);
 938   1           Lcd_set_val("jiaodu.val=",(int)(*(real_data)*0.01));//å‘LCDæ¨¡ç»„å‘é€å®šä½å€¼
 939   1           delayms(10);
 940   1           
 941   1           
 942   1           send_data(0x81,0x97,2); //æŸ¥è¯¢IRæ¥æ”¶çŠ¶æ€
 943   1           delayms(30);
 944   1           if((*(real_data)>>8)!=0xf1)
 945   1           {
 946   2             Lcd_set_val("ir4.val=",*(real_data)>>8);
 947   2             delayms(10);
 948   2             Lcd_set_val("ir3.val=",*(real_data)& 0x00ff);
 949   2             delayms(10);
 950   2             Lcd_set_val("ir2.val=",*(real_data+1)>>8);
 951   2             delayms(10);
 952   2             Lcd_set_val("ir1.val=",*(real_data+1)& 0x00ff);
 953   2             delayms(10);
 954   2           }
 955   1           //delayms(100);
 956   1           
 957   1           //lcd_status=0;//çŠ¶æ€æ¸…é›¶
 958   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 959   1      }
 960          //*
 961          int robot_ctrl_window1(unsigned short *real_data)//æ•´æœºæ§åˆ¶éƒ¨åˆ†
 962          {        
 963   1             unsigned short run_speed = 250;//æœ€å¤§å€¼700
 964   1             unsigned short tun_speed =100;  
 965   1            *real_data = 0xf1f0;
 966   1      
 967   1             switch(lcd_status)
 968   1             {
 969   2                case auto_charge_on : main_board_contrl_send1(0x80,0,0);  break;
 970   2                case auto_charge_off : main_board_contrl_send1(0x00,0,0);  break;
 971   2                case go_up : main_board_contrl_send1(0x01,run_speed,run_speed);  break;
 972   2                case go_down : main_board_contrl_send1(0x02,run_speed,run_speed); break;
 973   2                case go_left : main_board_contrl_send1(0x04,0,tun_speed); break;
 974   2                case go_right : main_board_contrl_send1(0x03,tun_speed,0); break;
 975   2                case go_stop : main_board_contrl_send1(0x05,0,0); //è¢«åŠ¨åˆ¹è½¦
 976   2                               delayms(30);
 977   2                               main_board_contrl_send1(0x00,0,0); //ç©ºæŒ¡æ— é˜»åŠ›
 978   2                               break;
 979   2                 default :break;
 980   2              }
 981   1          
 982   1           if(lcd_status==Return_button1)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 983   1           {
C51 COMPILER V9.00   LCD_WINDOW                                                            06/10/2019 10:11:19 PAGE 17  

 984   2              //printf("return_button\n");
 985   2              Lcd_control( "page main1");
 986   2              lcd_status = main_window;
 987   2              main_board_contrl_send1(0x05,0,0); //è¢«åŠ¨åˆ¹è½¦
 988   2              delayms(30);
 989   2              main_board_contrl_send1(0x00,0,0); //ç©ºæŒ¡æ— é˜»åŠ›
 990   2              delayms(30);
 991   2              main_board_single_write(0x5a,0x5555);//é‡å¯ä¸»æ§æ¿
 992   2              delayms(30);         
 993   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 994   2           }
 995   1           delayms(10);
 996   1           send_data(0x81,0x88,1); //å‘é€æŸ¥è¯¢å®šä½çŠ¶æ€æŒ‡ä»¤
 997   1           delayms(30);
 998   1           Lcd_set_val("jiaodu.val=",(int)(*(real_data)*0.01));//å‘LCDæ¨¡ç»„å‘é€å®šä½å€¼
 999   1           delayms(10);
1000   1           
1001   1           
1002   1           send_data(0x81,0x99,2); //æŸ¥è¯¢IRæ¥æ”¶çŠ¶æ€
1003   1           delayms(30);
1004   1           if((*(real_data)>>8)!=0xf1)
1005   1           {
1006   2             Lcd_set_val("ir4.val=",*(real_data)>>8);
1007   2             delayms(10);
1008   2             Lcd_set_val("ir3.val=",*(real_data)& 0x00ff);
1009   2             delayms(10);
1010   2             Lcd_set_val("ir2.val=",*(real_data+1)>>8);
1011   2             delayms(10);
1012   2             Lcd_set_val("ir1.val=",*(real_data+1)& 0x00ff);
1013   2             delayms(10);
1014   2           }
1015   1           //delayms(100);
1016   1           
1017   1           //lcd_status=0;//çŠ¶æ€æ¸…é›¶
1018   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
1019   1      }//*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8261    ----
   CONSTANT SIZE    =    797    ----
   XDATA SIZE       =   ----     106
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
