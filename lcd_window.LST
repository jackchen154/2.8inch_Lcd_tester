C51 COMPILER V9.00   LCD_WINDOW                                                            02/03/2018 21:11:45 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD_WINDOW
OBJECT MODULE PLACED IN lcd_window.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE lcd_window.c LARGE BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "uart.h"
   2          #include "lcd_window.h"
   3          #include "main.h"
   4          #define uchar unsigned char
   5          #define FALSE  -1
   6          #define TRUE   0
   7          
   8          
   9          int Lcd_control(char *cmd)//æ¨¡å¼è®¾ç½®
  10          {
  11   1        //uchar receive_buf[4];//LCDè¿”å›æ•°æ®buf
  12   1        uchar *cmdbuf=(uchar *)cmd;
  13   1        uchar end_frame[]={0xff,0xff,0xff};//LCDå‘é€å¸§å°¾éƒ¨
  14   1        uchar len=0;
  15   1      
  16   1        while(*cmdbuf!='\0')//è®¡ç®—å­—ç¬¦ä¸ªæ•°
  17   1        {
  18   2          cmdbuf++;
  19   2          len++;
  20   2        }
  21   1         
  22   1        UART2_Send((uchar *)cmd,len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
  23   1        
  24   1        UART2_Send(end_frame,3);//å‘é€LCDå¸§å°¾
  25   1      
  26   1        return TRUE;   
  27   1      
  28   1      }
  29          
  30          /******************************************************************
  31          åŠŸèƒ½ï¼šå°†ä¸€ä¸ª32ä½é•¿æ•´å‹å˜é‡datè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æŠŠ1234è½¬ä¸º"1234"
  32          å‚æ•°ï¼šdat:å¾…è½¬çš„longå‹çš„å˜é‡
  33               str:æŒ‡å‘å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆï¼Œè½¬æ¢åçš„å­—èŠ‚ä¸²æ”¾åœ¨å…¶ä¸­   
  34          è¿”å›ï¼šè½¬æ¢åçš„å­—ç¬¦ä¸²é•¿åº¦                                
  35          ******************************************************************/
  36          unsigned char int2str(int dat,unsigned char *str) // é•¿æ•´å‹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿”å›å€¼ä¸ºè½¬æ¢å
             -çš„å­—ç¬¦ä¸²é•¿åº¦
  37          {
  38   1        signed char i=0;
  39   1        unsigned char len = 0;
  40   1        unsigned char buf[6]={0}; // é•¿æ•´æ•°æœ€å¤§å€¼4294967295ï¼Œè½¬ASCIIç åå ç”¨10+1=11å­—èŠ‚
  41   1        if (dat < 0)// å¦‚æœä¸ºè´Ÿæ•°ï¼Œé¦–å…ˆå–ç»å¯¹å€¼ï¼Œå¹¶æ·»åŠ è´Ÿå·
  42   1        {
  43   2          dat = -dat;
  44   2          *str++ = '-';
  45   2          len++;
  46   2        }
  47   1        do
  48   1        {// ä½ä½åœ¨å‰é«˜ä½åœ¨åé¡ºåºæ’åˆ—
  49   2          buf[i++] = dat % 10+0x30;// Cè¯­è¨€ä¸­æ•°ç»„ä¸‹æ ‡å›ºå®šä»0å¼€å§‹
  50   2          dat /= 10;
  51   2        } while (dat > 0);
  52   1        len += i;                 // iæœ€åçš„å€¼å°±æ˜¯æœ‰æ•ˆå­—ç¬¦çš„ä¸ªæ•°
  53   1        while (i-- > 0)           // é«˜ä½åœ¨å‰ä½ä½åœ¨åé¡ºåºæ’åˆ—
  54   1        {
C51 COMPILER V9.00   LCD_WINDOW                                                            02/03/2018 21:11:45 PAGE 2   

  55   2          *str++ = buf[i] ;
  56   2        }     
  57   1        *str = 0;                 // æ·»åŠ å­—ç¬¦ä¸²ç»“æŸç¬¦æ–¹ä¾¿ä½¿ç”¨KEILè‡ªå¸¦çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å¤„ç
             -†
  58   1        return len;               // è¿”å›å­—ç¬¦ä¸²é•¿åº¦
  59   1      }
  60          
  61          
  62          int Lcd_set_val(char *cmd, int val)//æ¨¡å¼è®¾ç½®
  63          {
  64   1        //uchar receive_buf[4];
  65   1        uchar val_buf[5]={0};//intè½¬charçš„ç¼“å­˜ 
  66   1        uchar val_len=0;//è½¬æ¢åçš„æ•°å­—æœ‰å¤šå°‘ä½æ•°
  67   1        uchar *cmd_buf = (uchar *)cmd;
  68   1        uchar end_frame[]={0xff,0xff,0xff};//å¸§å°¾
  69   1        uchar cmd_len=0;
  70   1        val_len = int2str(val,val_buf);//æ•´å‹è½¬å­—ç¬¦å‹
  71   1      
  72   1        while(*cmd_buf!='\0')
  73   1        {
  74   2          cmd_buf++;
  75   2          cmd_len++;
  76   2        }
  77   1      
  78   1        UART2_Send((uchar *)cmd,cmd_len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
  79   1      
  80   1        UART2_Send(val_buf,val_len);//å‘é€æ•°å­— 
  81   1      
  82   1        UART2_Send(end_frame,3);//å¸§å°¾éƒ¨
  83   1       
  84   1          return TRUE;    
  85   1      
  86   1      }
  87          
  88          
  89          //tou_led.txt="V2.0.2"
  90          int Lcd_set_txt(char *cmd,unsigned short *real_data)//æ¨¡å¼è®¾ç½®
  91          {
  92   1      
  93   1        uchar *cmd_buf = (uchar *)cmd;
  94   1        uchar clear_data=50;
  95   1        uchar end_frame[]={0xff,0xff,0xff};//å¸§å°¾
  96   1        uchar disbuf[8]={0};
  97   1        uchar cmd_len=0;
  98   1      
  99   1        disbuf[0]='"';
 100   1        disbuf[1]='V';
 101   1        disbuf[2]=(*(real_data)>>8)+48;
 102   1        disbuf[3]='.';
 103   1        disbuf[4]=(*(real_data)&0x00ff)+48;
 104   1        disbuf[5]='.';
 105   1        disbuf[6]=(*(real_data+1)>>8)+48;
 106   1        disbuf[7]='"';
 107   1      
 108   1        while(*cmd_buf!='\0')
 109   1        {
 110   2          cmd_buf++;
 111   2          cmd_len++;
 112   2        }
 113   1      
 114   1        UART2_Send((uchar *)cmd,cmd_len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
 115   1        
C51 COMPILER V9.00   LCD_WINDOW                                                            02/03/2018 21:11:45 PAGE 3   

 116   1        if(*(real_data)==0 && *(real_data+1)==0)
 117   1        UART2_Send((uchar *)"\"no device\"",11);
 118   1        else
 119   1        UART2_Send(disbuf,8);//å‘é€å€¼ 
 120   1        
 121   1        UART2_Send(end_frame,3);//å¸§å°¾éƒ¨
 122   1       
 123   1        while(clear_data--)
 124   1        {
 125   2          *real_data=0x0000;
 126   2          real_data++;
 127   2        }   
 128   1        return TRUE;    
 129   1        
 130   1      }
 131          
 132          
 133          int ultrasonic_window(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 134          {        
 135   1         uchar clear_data=50;                               
 136   1         Lcd_set_val("d0.val=",(*(real_data+chaosheng1) >> 8)*10);
 137   1         Lcd_set_val("d2.val=",(*(real_data+chaosheng1) & 0x00ff)*10);
 138   1         Lcd_set_val("d4.val=",(*(real_data+chaosheng2) >>8)*10);
 139   1         Lcd_set_val("d6.val=",(*(real_data+chaosheng2) & 0x00ff)*10);
 140   1         Lcd_set_val("d8.val=",(*(real_data+chaosheng3) >> 8)*10);
 141   1         Lcd_set_val("da.val=",(*(real_data+chaosheng3) & 0x00ff)*10);
 142   1         Lcd_set_val("dc.val=",(*(real_data+chaosheng4) >> 8)*10);
 143   1         Lcd_set_val("de.val=",(*(real_data+chaosheng4) & 0x00ff)*10);
 144   1         Lcd_set_val("e0.val=",(*(real_data+chaosheng5) >> 8)*10);
 145   1         Lcd_set_val("e2.val=",(*(real_data+chaosheng5) & 0x00ff)*10);
 146   1         Lcd_set_val("e4.val=",(*(real_data+chaosheng6) >> 8)*10);
 147   1         Lcd_set_val("e8.val=",(*(real_data+chaosheng6) & 0x00ff)*10);
 148   1         Lcd_set_val("hongwaizuo.val=",(*(real_data+hongwai2) >> 8)*2);
 149   1         Lcd_set_val("hongwaiyou.val=",(*(real_data+hongwai2) & 0x00ff)*2);
 150   1         
 151   1         while(clear_data--)
 152   1         {
 153   2          *real_data=0x0000;
 154   2          real_data++;
 155   2         }
 156   1         if(lcd_status==Return_button)
 157   1         {
 158   2              Lcd_control("page main");
 159   2              lcd_status = main_window;
 160   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 161   2         }
 162   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 163   1      }
 164          
 165          
 166          int version_window(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 167          {        
 168   1               
 169   1             //ç”µæºç®¡ç†æ¿
 170   1            send_data(0x05,0x78,3);
 171   1            delayms(30);
 172   1            Lcd_set_txt("dianyuanguanli.txt=",real_data);
 173   1            //èˆµæœºæ¿
 174   1            send_data(0x01,0x78,3);
 175   1            delayms(30);
 176   1            Lcd_set_txt("tou_duoji.txt=",real_data);
 177   1            //å·¦æ‰‹
C51 COMPILER V9.00   LCD_WINDOW                                                            02/03/2018 21:11:45 PAGE 4   

 178   1            send_data(0x06,0x78,3);
 179   1            delayms(30);
 180   1            Lcd_set_txt("zuoshou.txt=",real_data);
 181   1            //å³æ‰‹
 182   1            send_data(0x07,0x78,3);
 183   1            delayms(30);
 184   1            Lcd_set_txt("youshou.txt=",real_data);
 185   1            //å¤´å‘¼å¸ç¯æ¿
 186   1            send_data(0x03,0x78,3);
 187   1            delayms(30);
 188   1            Lcd_set_txt("tou_led.txt=",real_data);
 189   1            //è‡‚éƒ¨ç¯æ¿
 190   1            send_data(0x04,0x78,3);
 191   1            delayms(30);
 192   1            Lcd_set_txt("bibu_led.txt=",real_data);
 193   1                                      
 194   1           if(lcd_status==Return_button)
 195   1           {
 196   2              Lcd_control("page main");
 197   2              lcd_status = main_window;
 198   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 199   2           }
 200   1         
 201   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 202   1      }
 203          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1778    ----
   CONSTANT SIZE    =    266    ----
   XDATA SIZE       =   ----      68
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
