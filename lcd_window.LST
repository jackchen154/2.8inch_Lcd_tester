C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD_WINDOW
OBJECT MODULE PLACED IN lcd_window.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE lcd_window.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "STC12C5A.h"
   2          #include "uart.h"
   3          #include "lcd_window.h"
   4          #include "main.h"
   5          #define uchar unsigned char
   6          #define FALSE  -1
   7          #define TRUE   0
   8          
   9          
  10          int Lcd_control(char *cmd)//æ¨¡å¼è®¾ç½®
  11          {
  12   1        //uchar receive_buf[4];//LCDè¿”å›æ•°æ®buf
  13   1        uchar *cmdbuf=(uchar *)cmd;
  14   1        uchar end_frame[]={0xff,0xff,0xff};//LCDå‘é€å¸§å°¾éƒ¨
  15   1        uchar len=0;
  16   1      
  17   1        while(*cmdbuf!='\0')//è®¡ç®—å­—ç¬¦ä¸ªæ•°
  18   1        {
  19   2          cmdbuf++;
  20   2          len++;
  21   2        }
  22   1         
  23   1        UART2_Send((uchar *)cmd,len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
  24   1        delayms(10);
  25   1        UART2_Send(end_frame,3);//å‘é€LCDå¸§å°¾
  26   1      
  27   1        return TRUE;   
  28   1      
  29   1      }
  30          
  31          /******************************************************************
  32          åŠŸèƒ½ï¼šå°†ä¸€ä¸ª32ä½é•¿æ•´å‹å˜é‡datè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æŠŠ1234è½¬ä¸º"1234"
  33          å‚æ•°ï¼šdat:å¾…è½¬çš„longå‹çš„å˜é‡
  34               str:æŒ‡å‘å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆï¼Œè½¬æ¢åçš„å­—èŠ‚ä¸²æ”¾åœ¨å…¶ä¸­   
  35          è¿”å›ï¼šè½¬æ¢åçš„å­—ç¬¦ä¸²é•¿åº¦                                
  36          ******************************************************************/
  37          unsigned char int2str(int dat,unsigned char *str) // é•¿æ•´å‹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿”å›å€¼ä¸ºè½¬æ¢å
             -çš„å­—ç¬¦ä¸²é•¿åº¦
  38          {
  39   1        signed char i=0;
  40   1        unsigned char len = 0;
  41   1        unsigned char buf[6]={0}; // é•¿æ•´æ•°æœ€å¤§å€¼4294967295ï¼Œè½¬ASCIIç åå ç”¨10+1=11å­—èŠ‚
  42   1        if (dat < 0)// å¦‚æœä¸ºè´Ÿæ•°ï¼Œé¦–å…ˆå–ç»å¯¹å€¼ï¼Œå¹¶æ·»åŠ è´Ÿå·
  43   1        {
  44   2          dat = -dat;
  45   2          *str++ = '-';
  46   2          len++;
  47   2        }
  48   1        do
  49   1        {// ä½ä½åœ¨å‰é«˜ä½åœ¨åé¡ºåºæ’åˆ—
  50   2          buf[i++] = dat % 10+0x30;// Cè¯­è¨€ä¸­æ•°ç»„ä¸‹æ ‡å›ºå®šä»0å¼€å§‹
  51   2          dat /= 10;
  52   2        } while (dat > 0);
  53   1        len += i;                 // iæœ€åçš„å€¼å°±æ˜¯æœ‰æ•ˆå­—ç¬¦çš„ä¸ªæ•°
  54   1        while (i-- > 0)           // é«˜ä½åœ¨å‰ä½ä½åœ¨åé¡ºåºæ’åˆ—
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 2   

  55   1        {
  56   2          *str++ = buf[i] ;
  57   2        }     
  58   1        *str = 0;                 // æ·»åŠ å­—ç¬¦ä¸²ç»“æŸç¬¦æ–¹ä¾¿ä½¿ç”¨KEILè‡ªå¸¦çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å¤„ç
             -†
  59   1        return len;               // è¿”å›å­—ç¬¦ä¸²é•¿åº¦
  60   1      }
  61          
  62          
  63          int Lcd_set_val(char *cmd, int val)//æ¨¡å¼è®¾ç½®
  64          {
  65   1        //uchar receive_buf[4];
  66   1        uchar val_buf[5]={0};//intè½¬charçš„ç¼“å­˜ 
  67   1        uchar val_len=0;//è½¬æ¢åçš„æ•°å­—æœ‰å¤šå°‘ä½æ•°
  68   1        uchar *cmd_buf = (uchar *)cmd;
  69   1        uchar end_frame[]={0xff,0xff,0xff};//å¸§å°¾
  70   1        uchar cmd_len=0;
  71   1        val_len = int2str(val,val_buf);//æ•´å‹è½¬å­—ç¬¦å‹
  72   1      
  73   1        while(*cmd_buf!='\0')
  74   1        {
  75   2          cmd_buf++;
  76   2          cmd_len++;
  77   2        }
  78   1      
  79   1        UART2_Send((uchar *)cmd,cmd_len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
  80   1      
  81   1        UART2_Send(val_buf,val_len);//å‘é€æ•°å­— 
  82   1      
  83   1        UART2_Send(end_frame,3);//å¸§å°¾éƒ¨
  84   1       
  85   1          return TRUE;    
  86   1      
  87   1      }
  88          
  89          
  90          //tou_led.txt="V2.0.2"
  91          int Lcd_set_txt(char *cmd,unsigned short *real_data)//æ¨¡å¼è®¾ç½®
  92          {
  93   1      
  94   1        uchar *cmd_buf = (uchar *)cmd;
  95   1        uchar clear_data=50;
  96   1        uchar end_frame[]={0xff,0xff,0xff};//å¸§å°¾
  97   1        uchar disbuf[9]={0};
  98   1        uchar cmd_len=0;
  99   1      
 100   1        disbuf[0]='"';
 101   1        disbuf[1]='V';
 102   1        if((*(real_data)>>8)>9)
 103   1        {
 104   2          disbuf[2]=(*(real_data)>>8)/10+48;
 105   2          disbuf[3]=(*(real_data)>>8)%10+48;
 106   2        }
 107   1        else
 108   1        {
 109   2          disbuf[2]= 32;
 110   2          disbuf[3]=(*(real_data)>>8)+48;
 111   2        }
 112   1        disbuf[4]='.';
 113   1        disbuf[5]=(*(real_data)&0x00ff)+48;
 114   1        disbuf[6]='.';
 115   1        disbuf[7]=(*(real_data+1)>>8)+48;
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 3   

 116   1        disbuf[8]='"';
 117   1      
 118   1        while(*cmd_buf!='\0')
 119   1        {
 120   2          cmd_buf++;
 121   2          cmd_len++;
 122   2        }
 123   1      
 124   1        UART2_Send((uchar *)cmd,cmd_len);//å‘é€LCDæ§åˆ¶æŒ‡ä»¤
 125   1        
 126   1        if(*(real_data)==0 && *(real_data+1)==0)
 127   1        UART2_Send((uchar *)"\"no device\"",11);
 128   1        else
 129   1        UART2_Send(disbuf,9);//å‘é€å€¼ 
 130   1        
 131   1        UART2_Send(end_frame,3);//å¸§å°¾éƒ¨
 132   1       
 133   1        while(clear_data--)
 134   1        {
 135   2          *real_data=0x0000;
 136   2          real_data++;
 137   2        }   
 138   1        return TRUE;    
 139   1        
 140   1      }
 141          
 142          
 143          int ultrasonic_window(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 144          {        
 145   1         uchar clear_data=50; 
 146   1      
 147   1      
 148   1         send_data(0x81,0x80,27); 
 149   1         delayms(30);
 150   1         Lcd_set_val("d0.val=",(*(real_data+chaosheng1) >> 8)*10);
 151   1         Lcd_set_val("d2.val=",(*(real_data+chaosheng1) & 0x00ff)*10);
 152   1         Lcd_set_val("d4.val=",(*(real_data+chaosheng2) >>8)*10);
 153   1         Lcd_set_val("d6.val=",(*(real_data+chaosheng2) & 0x00ff)*10);
 154   1         Lcd_set_val("d8.val=",(*(real_data+chaosheng3) >> 8)*10);
 155   1         Lcd_set_val("da.val=",(*(real_data+chaosheng3) & 0x00ff)*10);
 156   1         Lcd_set_val("dc.val=",(*(real_data+chaosheng4) >> 8)*10);
 157   1         Lcd_set_val("de.val=",(*(real_data+chaosheng4) & 0x00ff)*10);
 158   1         Lcd_set_val("e0.val=",(*(real_data+chaosheng5) >> 8)*10);
 159   1         Lcd_set_val("e2.val=",(*(real_data+chaosheng5) & 0x00ff)*10);
 160   1         Lcd_set_val("e4.val=",(*(real_data+chaosheng6) >> 8)*10);
 161   1         Lcd_set_val("e8.val=",(*(real_data+chaosheng6) & 0x00ff)*10);
 162   1         Lcd_set_val("hongwaizuo.val=",(*(real_data+hongwai2) >> 8)*2);
 163   1         Lcd_set_val("hongwaiyou.val=",(*(real_data+hongwai2) & 0x00ff)*2);
 164   1         
 165   1         while(clear_data--)
 166   1         {
 167   2          *real_data=0x0000;
 168   2          real_data++;
 169   2         }
 170   1         if(lcd_status==Return_button)
 171   1         {
 172   2              Lcd_control("page main");
 173   2              lcd_status = main_window;
 174   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 175   2         }
 176   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 177   1      }
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 4   

 178          
 179          
 180          int version_window(unsigned short *real_data)// ä¼ æ„Ÿå™¨çª—å£æ•°æ®åˆ·æ–°
 181          {        
 182   1             TH1 = 0xf7;  
 183   1             TL1 = TH1; //38400æ³¢ç‰¹ç‡ 
 184   1             delayms(30);
 185   1             //ç”µæºç®¡ç†æ¿
 186   1            send_data(0x05,0x78,3);
 187   1            delayms(30);
 188   1            Lcd_set_txt("dianyuanguanli.txt=",real_data);
 189   1            //èˆµæœºæ¿
 190   1            send_data(0x01,0x78,3);
 191   1            delayms(30);
 192   1            Lcd_set_txt("tou_duoji.txt=",real_data);
 193   1            //å•æµ‹å³è½®
 194   1            send_data(0x02,0x78,3);
 195   1            delayms(30);
 196   1            Lcd_set_txt("danyoulun.txt=",real_data);
 197   1            //å·¦æ‰‹
 198   1            send_data(0x06,0x78,3);
 199   1            delayms(30);
 200   1            Lcd_set_txt("zuoshou.txt=",real_data);
 201   1            //å³æ‰‹
 202   1            send_data(0x07,0x78,3);
 203   1            delayms(30);
 204   1            Lcd_set_txt("youshou.txt=",real_data);
 205   1            //å¤´å‘¼å¸ç¯æ¿
 206   1            send_data(0x03,0x78,3);
 207   1            delayms(30);
 208   1            Lcd_set_txt("tou_led.txt=",real_data);
 209   1            
 210   1            TH1 = 0xFD;   
 211   1            TL1 = TH1;  //115200æ³¢ç‰¹ç‡ 
 212   1            //ä¸»æ§æ¿
 213   1            send_data(0x81,0x78,3);
 214   1            delayms(30);
 215   1            Lcd_set_txt("zhukong.txt=",real_data);
 216   1            //è¶…å®½å¸¦
 217   1            send_data(0x81,0xB1,3);
 218   1            delayms(30);
 219   1            Lcd_set_txt("chaokuandai.txt=",real_data);      
 220   1            //å·¦è½®
 221   1            send_data(0x81,0xB4,3);
 222   1            delayms(30);
 223   1            Lcd_set_txt("zuolun.txt=",real_data);    
 224   1            //å³è½®
 225   1            send_data(0x81,0xB7,3);
 226   1            delayms(30);
 227   1            Lcd_set_txt("youlun.txt=",real_data);
 228   1            
 229   1           if(lcd_status==Return_button)
 230   1           {
 231   2              Lcd_control("page main");
 232   2              lcd_status = main_window;
 233   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 234   2           }
 235   1         
 236   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 237   1      }
 238          
 239          
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 5   

 240          int motor_ctrl_window(unsigned short *real_data)//èˆµæœºæ§åˆ¶çª—å£
 241          {        
 242   1               
 243   1            uchar turn_speed = 8;
 244   1            send_data(0x01,0x7e,2);
 245   1            delayms(30);
 246   1            Lcd_set_val("hbianmaqiz.val=", (int)(*(real_data)));
 247   1            delayms(30);
 248   1            Lcd_set_val("hbiaodingz.val=", (int)(*(real_data+1)));
 249   1            *(real_data)=0;
 250   1            *(real_data+1)=0;
 251   1      
 252   1            send_data(0x06,0x7e,2);
 253   1            delayms(30);
 254   1            Lcd_set_val("zbianmaqiz.val=", (int)(*(real_data)));
 255   1            delayms(30);
 256   1            Lcd_set_val("zbiaodingz.val=", (int)(*(real_data+1)));
 257   1            *(real_data)=0;
 258   1            *(real_data+1)=0;
 259   1      
 260   1            send_data(0x07,0x7e,2);
 261   1            delayms(30);
 262   1            Lcd_set_val("ybianmaqiz.val=", (int)(*(real_data)));
 263   1            delayms(30);
 264   1            Lcd_set_val("ybiaodingz.val=", (int)(*(real_data+1)));
 265   1            *(real_data)=0;
 266   1            *(real_data+1)=0;
 267   1            //*å¤´éƒ¨æ§åˆ¶éƒ¨åˆ†
 268   1            if(lcd_status==hbiaoding)//å¤´éƒ¨æ ‡å®šæ£€æµ‹
 269   1            {
 270   2              motor_contrl_send(0x01,0x05,0,0);
 271   2              delayms(30);
 272   2              motor_contrl_send(0x01,0x05,0,0);
 273   2              delayms(30);         
 274   2              motor_contrl_send(0x01,0x00,0,0);
 275   2            }
 276   1            if(lcd_status==hzuo)//å¤´éƒ¨æ­£è½¬
 277   1            {
 278   2              motor_contrl_send(0x01,0x01,turn_speed,0);    
 279   2            }
 280   1            if(lcd_status==hyou)//å¤´éƒ¨åè½¬
 281   1            {
 282   2              motor_contrl_send(0x01,0x02,turn_speed,0);        
 283   2            }
 284   1            if(lcd_status==hzhong)//å¤´éƒ¨æ­£ä¸­
 285   1            {
 286   2              motor_contrl_send( 0x01,0x03,turn_speed,180);
 287   2              delayms(2000);
 288   2              motor_contrl_send( 0x01,0x00,0,0);        
 289   2            }//*/
 290   1      
 291   1            //å·¦æ‰‹æ§åˆ¶éƒ¨åˆ†
 292   1            if(lcd_status==zbiaoding)//å·¦æ‰‹æ ‡å®šæ£€æµ‹
 293   1            {
 294   2              motor_contrl_send( 0x06,0x05,0,0);
 295   2              delayms(30);
 296   2              motor_contrl_send( 0x06,0x05,0,0);
 297   2              delayms(30);         
 298   2              motor_contrl_send( 0x06,0x00,0,0);//é€€å‡ºæ ‡å®šçŠ¶æ€
 299   2            }
 300   1            if(lcd_status==zzuo)//å·¦æ‰‹æ­£è½¬
 301   1            {
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 6   

 302   2              motor_contrl_send( 0x06,0x01,7,0);    
 303   2            }
 304   1            if(lcd_status==zyou)//å·¦æ‰‹åè½¬
 305   1            {
 306   2              motor_contrl_send( 0x06,0x02,7,0);        
 307   2            }
 308   1            if(lcd_status==zzhong)//å·¦æ‰‹æ­£ä¸­
 309   1            {
 310   2              motor_contrl_send( 0x06,0x03,7,180);
 311   2              delayms(2000);
 312   2              motor_contrl_send( 0x06,0x00,0,0);        
 313   2            }
 314   1      
 315   1            //*å³æ‰‹æ§åˆ¶éƒ¨åˆ†
 316   1            if(lcd_status==ybiaoding)//å·¦æ‰‹æ ‡å®šæ£€æµ‹
 317   1            {
 318   2              motor_contrl_send( 0x07,0x05,0,0);
 319   2              delayms(30);
 320   2              motor_contrl_send( 0x07,0x05,0,0);
 321   2              delayms(30);         
 322   2              motor_contrl_send( 0x07,0x00,0,0);//é€€å‡ºæ ‡å®šçŠ¶æ€
 323   2            }
 324   1            if(lcd_status==yzuo)//å·¦æ‰‹æ­£è½¬
 325   1            {
 326   2              ////printf("yzuo\n");
 327   2              motor_contrl_send( 0x07,0x01,7,0);    
 328   2            }
 329   1            if(lcd_status==yyou)//å·¦æ‰‹åè½¬
 330   1            {
 331   2              ////printf("yyou\n");
 332   2              motor_contrl_send( 0x07,0x02,7,0);        
 333   2            }
 334   1            if(lcd_status==yzhong)//å·¦æ‰‹æ­£ä¸­
 335   1            {
 336   2              ////printf("yzhong\n");
 337   2              motor_contrl_send( 0x07,0x03,7,180);
 338   2              delayms(2000);
 339   2              motor_contrl_send( 0x07,0x00,0,0);        
 340   2            }
 341   1      
 342   1            //LEDç¯æ¿æ§åˆ¶éƒ¨åˆ†
 343   1            if(lcd_status==led00)
 344   1            {
 345   2              //printf("led00\n");
 346   2              led_contrl_send( 0x03,0,0,100);
 347   2            }
 348   1            if(lcd_status==led01)
 349   1            {
 350   2              //printf("led01\n");
 351   2              led_contrl_send( 0x03,0,35,100);
 352   2            }
 353   1            if(lcd_status==led10)
 354   1            {
 355   2              //printf("led10\n");
 356   2              led_contrl_send( 0x03,35,0,100);
 357   2            }
 358   1            if(lcd_status==led11)
 359   1            {
 360   2              //printf("led11\n");
 361   2              led_contrl_send( 0x03,35,35,100);
 362   2            }
 363   1      
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 7   

 364   1            //è¿ç»­æ§åˆ¶éƒ¨åˆ†
 365   1            if(lcd_status==alianxu1)
 366   1            {
 367   2              //printf("alianxu1\n");
 368   2              while(1)
 369   2              {
 370   3                motor_contrl_send( 0x01,0x01,9,0);//å¤´éƒ¨æ­£è½¬
 371   3                delayms(30);
 372   3                motor_contrl_send( 0x06,0x01,7,0);//å·¦æ‰‹æ­£è½¬ 
 373   3                delayms(30);
 374   3                motor_contrl_send( 0x07,0x01,7,0);//å³æ‰‹æ­£è½¬ 
 375   3                delayms(30);
 376   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹
 377   3                if(lcd_status==Return_button) break;
 378   3                delayms(3500);
 379   3                if(lcd_status==Return_button) break;
 380   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹     
 381   3                motor_contrl_send( 0x01,0x02,9,0);//å¤´éƒ¨åè½¬       
 382   3                delayms(30);
 383   3                motor_contrl_send( 0x06,0x02,7,0);//å·¦æ‰‹åè½¬
 384   3                delayms(30);
 385   3                if(lcd_status==Return_button) break;
 386   3                motor_contrl_send( 0x07,0x02,7,0);//å³æ‰‹åè½¬
 387   3                delayms(30);
 388   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹     
 389   3                delayms(3500);
 390   3                if(lcd_status==Return_button) break;
 391   3                if(lcd_status==alianxu0) break;//é€€å‡ºæ£€æµ‹       
 392   3              }
 393   2              //printf("alianxu0\n");
 394   2              //é€€å‡ºå›æ­£
 395   2              motor_contrl_send( 0x01,0x03,9,180);//å¤´å›æ­£
 396   2              delayms(30);
 397   2              motor_contrl_send( 0x06,0x03,7,180);//å·¦æ‰‹å›æ­£
 398   2              delayms(30);
 399   2              motor_contrl_send( 0x07,0x03,7,180);//å³æ‰‹å›æ­£
 400   2              delayms(30);
 401   2              delayms(2000);//ç­‰å¾…å›æ­£å®Œæ¯•
 402   2      
 403   2              //é€€å‡ºåè®¾ç½®ä¸ºè‡ªç„¶åœæ­¢
 404   2              motor_contrl_send( 0x01,0x00,0,0);//å¤´åœæ­¢ 
 405   2              delayms(30);
 406   2              motor_contrl_send( 0x06,0x00,0,0);//å·¦æ‰‹åœæ­¢ 
 407   2              delayms(30);
 408   2              motor_contrl_send( 0x07,0x00,0,0);//å³æ‰‹åœæ­¢
 409   2              delayms(30);      
 410   2            }//*/
 411   1      
 412   1           if(lcd_status==Return_button)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 413   1           {
 414   2              //printf("return_button\n");
 415   2              Lcd_control( "page main");
 416   2              lcd_status = main_window;
 417   2              //é€€å‡ºå›æ­£
 418   2              motor_contrl_send( 0x01,0x03,9,180);//å¤´å›æ­£
 419   2              delayms(30);
 420   2              motor_contrl_send( 0x06,0x03,7,180);//å·¦æ‰‹å›æ­£
 421   2              delayms(30);
 422   2              motor_contrl_send( 0x07,0x03,7,180);//å³æ‰‹å›æ­£
 423   2              delayms(30);
 424   2              delayms(2000);//ç­‰å¾…å›æ­£å®Œæ¯•
 425   2              //é€€å‡ºåè®¾ç½®ä¸ºè‡ªç„¶åœæ­¢
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 8   

 426   2              motor_contrl_send( 0x01,0x00,0,0);//å¤´åœæ­¢ 
 427   2              delayms(30);
 428   2              motor_contrl_send( 0x06,0x00,0,0);//å·¦æ‰‹åœæ­¢ 
 429   2              delayms(30);
 430   2              motor_contrl_send( 0x07,0x00,0,0);//å³æ‰‹åœæ­¢
 431   2              delayms(30); 
 432   2      
 433   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 434   2           }
 435   1      
 436   1           lcd_status=0;//çŠ¶æ€æ¸…é›¶
 437   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 438   1      }
 439          
 440          int Duojixianzhi_window(unsigned short *real_data)//èˆµæœºé™åˆ¶çª—å£
 441          {                
 442   1            //å¤´éƒ¨é™åˆ¶æŸ¥è¯¢
 443   1            send_data(0x01,0x80,1);//è¯»é™å®šç”µæµå€¼
 444   1            delayms(30);
 445   1            Lcd_set_val("htouxianliu.val=", *(real_data));
 446   1            delayms(30);
 447   1            *(real_data)=0;
 448   1        
 449   1            send_data(0x01,0x0B,2);//è¯»é™ä½å€¼
 450   1            delayms(30);
 451   1            Lcd_set_val("htoushangxw.val=", (int)(*(real_data)));
 452   1            delayms(30);
 453   1            Lcd_set_val("htouxiaxw.val=", (int)(*(real_data+1)));
 454   1            *(real_data)=0;
 455   1            *(real_data+1)=0;
 456   1      
 457   1            //ä¿¯ä»°é™åˆ¶æŸ¥è¯¢
 458   1            send_data(0x02,0x80,1);//è¯»é™å®šç”µæµå€¼
 459   1            delayms(30);
 460   1            Lcd_set_val("fyxianliu.val=", *(real_data));
 461   1            delayms(30);
 462   1            *(real_data)=0;
 463   1        
 464   1            send_data(0x02,0x0B,2);//è¯»é™ä½å€¼
 465   1            delayms(30);
 466   1            Lcd_set_val("fyshangxianw.val=", (int)(*(real_data)));
 467   1            delayms(30);
 468   1            Lcd_set_val("fyxiaxianw.val=", (int)(*(real_data+1)));
 469   1            *(real_data)=0;
 470   1            *(real_data+1)=0;
 471   1      
 472   1            //å·¦æ‰‹é™åˆ¶æŸ¥è¯¢
 473   1            send_data(0x06,0x80,1);//è¯»é™å®šç”µæµå€¼
 474   1            delayms(30);
 475   1            Lcd_set_val("zuoxianliu.val=", *(real_data));
 476   1            delayms(30);
 477   1            *(real_data)=0;
 478   1        
 479   1            send_data(0x06,0x0B,2);//è¯»é™ä½å€¼
 480   1            delayms(30);
 481   1            Lcd_set_val("zuoshangxw.val=", (int)(*(real_data)));
 482   1            delayms(30);
 483   1            Lcd_set_val("zuoxiaxw.val=", (int)(*(real_data+1)));
 484   1            *(real_data)=0;
 485   1            *(real_data+1)=0;
 486   1            
 487   1            //å³æ‰‹é™åˆ¶æŸ¥è¯¢
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 9   

 488   1            send_data(0x07,0x80,1);//è¯»é™å®šç”µæµå€¼
 489   1            delayms(30);
 490   1            Lcd_set_val("yshouxianliu.val=", *(real_data));
 491   1            delayms(30);
 492   1            *(real_data)=0;
 493   1        
 494   1            send_data(0x07,0x0B,2);//è¯»é™ä½å€¼
 495   1            delayms(30);
 496   1            Lcd_set_val("yshoushangxw.val=", (int)(*(real_data)));
 497   1            delayms(30);
 498   1            Lcd_set_val("yshaouxiaxw.val=", (int)(*(real_data+1)));
 499   1            *(real_data)=0;
 500   1            *(real_data+1)=0;     
 501   1            
 502   1            //*ä¸€é”®é™åˆ¶é…ç½®éƒ¨åˆ†
 503   1            if(lcd_status==set_limit_value)
 504   1            {
 505   2              //å¤´éƒ¨èˆµæœº 
 506   2              limit_current_contrl_send(0x01,6);//å¤´0.6Açš„é™åˆ¶ç”µæµ
 507   2              delayms(30);
 508   2              limit_value_contrl_send(0x01 ,90,90);//å¤´90åº¦é™ä½å€¼å‘é€
 509   2              delayms(30);
 510   2              //ä¿¯ä»°èˆµæœº        
 511   2              limit_current_contrl_send(0x02,6);//ä¿¯ä»°0.6Açš„é™åˆ¶ç”µæµ
 512   2              delayms(30);
 513   2              limit_value_contrl_send(0x02 ,9,9);//å¹³å®‰ä¿¯ä»°9åº¦é™ä½å€¼å‘é€
 514   2              delayms(30);
 515   2              //å·¦æ‰‹èˆµæœº 
 516   2              limit_current_contrl_send(0x06,10);//å¤´1Açš„é™åˆ¶ç”µæµ
 517   2              delayms(30);
 518   2              limit_value_contrl_send(0x06 ,90,90);//å¤´90åº¦é™ä½å€¼å‘é€
 519   2              delayms(30);
 520   2              //å³æ‰‹èˆµæœº        
 521   2              limit_current_contrl_send(0x07,10);//ä¿¯ä»°1Açš„é™åˆ¶ç”µæµ
 522   2              delayms(30);
 523   2              limit_value_contrl_send(0x07 ,90,90);//ä¿¯ä»°90åº¦é™ä½å€¼å‘é€
 524   2              delayms(30);          
 525   2            }
 526   1      
 527   1           if(lcd_status==Return_button)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 528   1           {
 529   2              //printf("return_button\n");
 530   2              Lcd_control( "page main");
 531   2              lcd_status = main_window;
 532   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 533   2           }
 534   1      
 535   1           lcd_status=0;//çŠ¶æ€æ¸…é›¶
 536   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 537   1      }
 538          
 539          
 540          
 541          //void main_board_contrl_send(uchar run_mode,uchar left_speed,uchar right_speed);//ä¸»æ§æ¿å¤šå†™
 542          int robot_ctrl_window(unsigned short *real_data)//æ•´æœºæ§åˆ¶éƒ¨åˆ†
 543          {        
 544   1            *real_data = 0xf1f0;  
 545   1             switch(lcd_status)
 546   1             {
 547   2                case auto_charge_on : main_board_contrl_send(0x80,0,0);  break;
 548   2                case auto_charge_off : main_board_contrl_send(0x00,0,0);  break;
 549   2                case go_up : main_board_contrl_send(0x01,40,40);  break;
C51 COMPILER V9.00   LCD_WINDOW                                                            09/18/2018 17:05:05 PAGE 10  

 550   2                case go_down : main_board_contrl_send(0x02,40,40); break;
 551   2                case go_left : main_board_contrl_send(0x04,0,25); break;
 552   2                case go_right : main_board_contrl_send(0x03,25,0); break;
 553   2                case go_stop : main_board_contrl_send(0x05,0,0); //è¢«åŠ¨åˆ¹è½¦
 554   2                               delayms(30);
 555   2                               main_board_contrl_send(0x00,0,0); //ç©ºæŒ¡æ— é˜»åŠ›
 556   2                               break;
 557   2                 default :break;
 558   2              }
 559   1          
 560   1           if(lcd_status==Return_button)//æŒ‰ä¸‹é€€å‡ºæŒ‰é”®
 561   1           {
 562   2              //printf("return_button\n");
 563   2              Lcd_control( "page main");
 564   2              lcd_status = main_window;
 565   2              main_board_contrl_send(0x05,0,0); //è¢«åŠ¨åˆ¹è½¦
 566   2              delayms(30);
 567   2              main_board_contrl_send(0x00,0,0); //ç©ºæŒ¡æ— é˜»åŠ›
 568   2              return -1;//å¦‚æœå—åˆ°è¿”å›ä¿¡å·
 569   2           }
 570   1           delayms(10);
 571   1           send_data(0x81,0x88,1); //å‘é€æŸ¥è¯¢å®šä½çŠ¶æ€æŒ‡ä»¤
 572   1           delayms(30);
 573   1           Lcd_set_val("jiaodu.val=",(int)(*(real_data)*0.01));//å‘LCDæ¨¡ç»„å‘é€å®šä½å€¼
 574   1           delayms(10);
 575   1           
 576   1           
 577   1           send_data(0x81,0x97,2); //æŸ¥è¯¢IRæ¥æ”¶çŠ¶æ€
 578   1           delayms(30);
 579   1           if((*(real_data)>>8)!=0xf1)
 580   1           {
 581   2             Lcd_set_val("ir4.val=",*(real_data)>>8);
 582   2             delayms(10);
 583   2             Lcd_set_val("ir3.val=",*(real_data)& 0x00ff);
 584   2             delayms(10);
 585   2             Lcd_set_val("ir2.val=",*(real_data+1)>>8);
 586   2             delayms(10);
 587   2             Lcd_set_val("ir1.val=",*(real_data+1)& 0x00ff);
 588   2             delayms(10);
 589   2           }
 590   1           //delayms(100);
 591   1           
 592   1           //lcd_status=0;//çŠ¶æ€æ¸…é›¶
 593   1         return 0;//æ­£å¸¸åˆ·æ–°æ•°æ®
 594   1      }
 595          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4937    ----
   CONSTANT SIZE    =    663    ----
   XDATA SIZE       =   ----      80
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
